====== Colony Hello World Tutorial ======

This tutorial will help you dive straight into Colony by developing a basic, but already extensible Colony plugin. 

By the end of this tutorial you should be able to:
    * Create a Colony plugin.
    * Create extension points in a Colony plugin.
    * Create plugins that use another's extension points to add new features.

For tradition's sake (as nauseating as it may be) let's dive into Colony by creating an Hello World application. However, ours will have a particular twist, for it will be modular from the very beginning. Follow these steps to have a very basic Hello World plugin running right of the bat:
    * Go to ''pt.hive.colony.plugins.configuration.startup/src/colony/plugins/configuration_startup/startup/resources/startup_configuration.xml'' and set the load attribute for ''pt.hive.colony.plugins.main.console'' as true and all others as false.
    * Create a new python project called ''pt.hive.colony.demo.plugins.hello_world''.
    * Add the following string to the ''plugin_path_list'' variable in ''pt.hive.colony/src/colony_configuration.py'': ''%colony_demo_prefix_path%/pt.hive.colony.demo.plugins.hello_world/src/colony/plugins''.
    * Create a project file within the following structure: ''src/colony/plugins/hello_world_plugin.py''
<code python>
import colony.plugins.plugin_system

class HelloWorldPlugin(colony.plugins.plugin_system.Plugin):

    id = "pt.hive.colony.demo.plugins.hello_world"
    name = "Hello World Plugin"
    version = "1.0.0"
    platforms = [colony.plugins.plugin_system.CPYTHON_ENVIRONMENT]
    capabilities = []
    capabilities_allowed = []
    dependencies = []

    def load_plugin(self):
        colony.plugins.plugin_system.Plugin.load_plugin(self)
        print "Hello World"
</code>

There you have it, you have just created your first Colony plugin. Yes... for real! You can now run Colony and type ''showall'' to list all the plugins and their current state and look for a plugin named ''pt.hive.colony.demo.plugins.hello_world''. You will probably find something along these lines:

<code txt>
ID      STATUS      PLUGIN ID
0       INACTIVE    pt.hive.colony.demo.plugins.hello_world
...
</code>

You can notice that the plugin is currently inactive, so try to load it by typing ''load 0'' (or whatever ID the plugin has). Provided everything went well, you will see the following output in the console:

<code txt>
Hello world
</code>

You have just loaded a plugin during runtime without having to restart the platform, in Colony you can load and unload plugins all the time without ever having to restart it, provided the plugins are correctly implemented. Let's have a look at ''showall'' again:

<code txt>
ID      STATUS      PLUGIN ID
0       ACTIVE      pt.hive.colony.demo.plugins.hello_world
...
</code>

The plugin is now active, you can unload it and load it whenever you want. Let's try unloading it by typing ''unload 0'' (or whatever ID the plugin has), and then ''showall'' again:

<code txt>
ID      STATUS      PLUGIN ID
0       INACTIVE    pt.hive.colony.demo.plugins.hello_world
...
</code>

Now type ''load 0'' (or whatever ID the plugin has) just once more:

<code txt>
Hello world
</code>

This plugin is modular in the context of the whole platform, as it can be loaded and unloaded at any time. However, we still haven't built any kind of modularity into our own plugin, so let's try expanding the Hello World plugin to support more languages. 

We want to design an Hello World plugin that will say Hello World in whatever language we specify, by allowing us to add new languages in the future, without ever having to modify its original code. In order to achieve this, it would be helpful to first have a way of easily issuing commands to the plugin. We will, for that purpose, extend Colony's command console, which is, like everything else, modular, to have a new command that allows us to interact with the Hello World plugin. There is no need to understand this step at this point in the learning curve, just follow the instructions by the letter and you'll be fine:

    * Create an empty project file within the following structure: ''src/colony/plugins/hello_world/%%__init__%%.py''
    * Create a project file within the following structure: ''src/colony/plugins/hello_world/console_hello_world.py''

<code python>
CONSOLE_EXTENSION_NAME = "hello_world"
""" The console extension name """

INVALID_NUMBER_ARGUMENTS_MESSAGE = "invalid number of arguments"
""" The invalid number of arguments message """

HELP_TEXT = "### HELLO WORLD HELP ###\n\
say_hello_world [language] - says hello world in the specified language"
""" The help text """

class ConsoleHelloWorld:
  
    commands = ["say_hello_world"]
    """ List of available commands """

    hello_world_plugin = None
    """ The hello world plugin """

    def __init__(self, hello_world_plugin = None):
        self.hello_world_plugin = hello_world_plugin

    def get_console_extension_name(self):
        return CONSOLE_EXTENSION_NAME

    def get_all_commands(self):
        return self.commands

    def get_handler_command(self, command):
        if command in self.commands:
            method_name = "process_" + command
            attribute = getattr(self, method_name)
            return attribute

    def get_help(self):
        return HELP_TEXT

    def process_say_hello_world(self, args, output_method):
        if len(args) < 1:
            output_method(INVALID_NUMBER_ARGUMENTS_MESSAGE)
            return

        # invokes the say hello world command
        self.hello_world_plugin.say_hello_world(args[0])
</code>
  * Update the ''hello_world_plugin.py'' file with this one:

<code python>
import colony.plugins.plugin_system

class HelloWorldPlugin(colony.plugins.plugin_system.Plugin):
    
    id = "pt.hive.colony.demo.plugins.hello_world"
    name = "Hello World Plugin"
    version = "1.0.0"
    platforms = [colony.plugins.plugin_system.CPYTHON_ENVIRONMENT]
    capabilities = ["console_command_extension"]
    capabilities_allowed = []
    dependencies = []

    console_hello_world = None
    """ The hello world console commands """
    
    def load_plugin(self):
        colony.plugins.plugin_system.Plugin.load_plugin(self)
        global hello_world
        import hello_world.console_hello_world
        self.console_hello_world = hello_world.console_hello_world.ConsoleHelloWorld(self)
        
    def get_console_extension_name(self):
        return self.console_hello_world.get_console_extension_name()

    def get_all_commands(self):
        return self.console_hello_world.get_all_commands()

    def get_handler_command(self, command):
        return self.console_hello_world.get_handler_command(command)

    def get_help(self):
        return self.console_hello_world.get_help()
    
    def say_hello_world(self, language):
        print "Hello world"
</code>

Restart Colony and try typing ''extensions''. A list of command line extensions should appear:

<code txt>
ID      NAME                        PLUGIN ID
0       hello_world                 pt.hive.colony.demo.plugins.hello_world
...
</code>

If the output was similar, then the console command extension we have added was correctly detected. Try typing ''help hello_world'' to get instructions on the commands provided by the Hello World plugin:

<code txt>
hello_world [language] - says hello world in the specified language
</code>

Try typing the command ''say_hello_world english'':

<code txt>
Hello world
</code>

You have just accessed your plugin via the command line by making it offer a capability that is allowed by the Colony command console. Now it's time to truly make the Hello World plugin extensible by adding the ability to extend it with new language plugins. The first thing we will do, just to keep the code clean, is to move the say_hello_world() code to a backend file, the plugin files should never contain logic, they should be as simple as possible, containing only description attributes and facade methods essentially. To perform this separation follow these steps:

    * Create a project file within the following structure: ''src/colony/plugins/hello_world/hello_world_system.py''

<code python>
class HelloWorld:
    
    hello_world_plugin = None
    """ The hello world plugin """

    def __init__(self, hello_world_plugin):
        self.hello_world_plugin = hello_world_plugin
        
    def say_hello_world(self, language):
        print "Hello world"
</code>

    * Update ''hello_world_plugin.py'' with the following code:

<code python>
import colony.plugins.plugin_system

class HelloWorldPlugin(colony.plugins.plugin_system.Plugin):
    
    id = "pt.hive.colony.demo.plugins.hello_world"
    name = "Hello World Plugin"
    version = "1.0.0"
    platforms = [colony.plugins.plugin_system.CPYTHON_ENVIRONMENT]
    capabilities = ["console_command_extension"]
    capabilities_allowed = []
    dependencies = []
    
    hello_world = None
    """ The hello world plugin's backend """

    console_hello_world = None
    """ The hello world console commands """
    
    def load_plugin(self):
        colony.plugins.plugin_system.Plugin.load_plugin(self)
        global hello_world
        import hello_world.hello_world_system
        import hello_world.console_hello_world
        self.hello_world = hello_world.hello_world_system.HelloWorld(self)
        self.console_hello_world = hello_world.console_hello_world.ConsoleHelloWorld(self)
        
    def get_console_extension_name(self):
        return self.console_hello_world.get_console_extension_name()

    def get_all_commands(self):
        return self.console_hello_world.get_all_commands()

    def get_handler_command(self, command):
        return self.console_hello_world.get_handler_command(command)

    def get_help(self):
        return self.console_hello_world.get_help()
    
    def say_hello_world(self, language):
        self.hello_world.say_hello_world(language)
</code>

Now we need to tell that our plugin accepts new languages. For that, we will add a new allowed capability to the Hello World plugin. From then on, any new plugin that provides that capability will be injected into the Hello World plugin. By defining this capability we are also defining a kind of contract, we are expecting the plugins that provide this capability to have certain methods, and any plugin that declares itself as having this capability will have the responsibility of implementing them. What we will require from a language plugin is basically something that tells us what language that plugin is for, and something to translate our sentence into that language, so let's state that from now on, any plugin that has the capability ''hello_world.language'' must have the get_language() and the translate(sentence) methods, and build our plugin accordingly:
    * Update ''hello_world_plugin.py'' to handle the ''hello_world.language'' capability:
<code python>
import colony.plugins.plugin_system
import colony.plugins.decorators

class HelloWorldPlugin(colony.plugins.plugin_system.Plugin):
    
    id = "pt.hive.colony.demo.plugins.hello_world"
    name = "Hello World Plugin"
    version = "1.0.0"
    platforms = [colony.plugins.plugin_system.CPYTHON_ENVIRONMENT]
    capabilities = ["console_command_extension"]
    capabilities_allowed = ["hello_world.language"]
    dependencies = []
    
    hello_world_language_plugins = []
    """ The injected hello world language plugins """
    
    hello_world = None
    """ The hello world plugin's backend """

    console_hello_world = None
    """ The hello world console commands """
    
    def load_plugin(self):
        colony.plugins.plugin_system.Plugin.load_plugin(self)
        global hello_world
        import hello_world.hello_world_system
        import hello_world.console_hello_world
        self.hello_world = hello_world.hello_world_system.HelloWorld(self)
        self.console_hello_world = hello_world.console_hello_world.ConsoleHelloWorld(self)
        
    @colony.plugins.decorators.load_allowed("pt.hive.colony.demo.plugins.hello_world", "1.0.0")
    def load_allowed(self, plugin, capability):
        colony.plugins.plugin_system.Plugin.load_allowed(self, plugin, capability)

    @colony.plugins.decorators.unload_allowed("pt.hive.colony.demo.plugins.hello_world", "1.0.0")
    def unload_allowed(self, plugin, capability):
        colony.plugins.plugin_system.Plugin.unload_allowed(self, plugin, capability)

    def get_console_extension_name(self):
        return self.console_hello_world.get_console_extension_name()

    def get_all_commands(self):
        return self.console_hello_world.get_all_commands()

    def get_handler_command(self, command):
        return self.console_hello_world.get_handler_command(command)

    def get_help(self):
        return self.console_hello_world.get_help()
    
    def say_hello_world(self, language):
        self.hello_world.say_hello_world(language)

    @colony.plugins.decorators.load_allowed_capability("hello_world.language")
    def hello_world_language_load_allowed(self, plugin, capability):
        self.hello_world_language_plugins.append(plugin)
        self.hello_world.add_language_plugin(plugin)

    @colony.plugins.decorators.unload_allowed_capability("hello_world.language")
    def hello_world_language_unload_allowed(self, plugin, capability):
        self.hello_world_language_plugins.remove(plugin)
        self.hello_world.remove_language_plugin(plugin)
</code>
    * Update ''hello_world_system.py'' to use the language plugins:
<code python>
HELLO_WORLD_VALUE = "Hello world"

class HelloWorld:
    
    hello_world_plugin = None
    """ The hello world plugin """
    
    language_plugin_map = {}
    """ Map associating a language with its plugin """
    
    def __init__(self, hello_world_plugin):
        self.hello_world_plugin = hello_world_plugin
        self.language_plugin_map = {}
    
    def add_language_plugin(self, language_plugin):
        language = language_plugin.get_language()
        self.language_plugin_map[language] = language_plugin
        
    def remove_language_plugin(self, language_plugin):
        language = language_plugin.get_language()
        del self.language_plugin_map[language]
        
    def say_hello_world(self, language):
        # returns in case no language plugin was found
        if not language in self.language_plugin_map:
            print "I don't know how to say Hello World in " +  language
            return
        
        # retrieves the plugin
        language_plugin = self.language_plugin_map[language]
        
        # translates hello world to the specified language
        hello_world = language_plugin.translate(HELLO_WORLD_VALUE)
        
        # prints hello world in the specified language
        print hello_world
</code>
    
The Hello World is now officially extensible. From this point onward, it shouldn't be necessary to touch the Hello World plugin's code ever again. To add a new language we will need to create a new plugin for that purpose. Meanwhile, let's try restarting Colony and typing ''say_hello_world english'' to make sure everything is still running correctly:

<code txt>
I don't know how to say Hello world in english
</code>

Despite the paradox uttered by the plugin, it should be running fine in case this was the output. Let's now teach the Hello World plugin how to say Hello World in Portuguese by creating a new Hello World Portuguese Language plugin:

    * Create a project file within the following structure: ''src/colony/plugins/hello_world_portuguese_language_plugin.py''

<code python>
import colony.plugins.plugin_system

PORTUGUESE_VALUE = "portuguese"

PORTUGUESE_LANGUAGE_HELLO_WORLD = "Ola mundo"

class HelloWorldPortugueseLanguagePlugin(colony.plugins.plugin_system.Plugin):
    
    id = "pt.hive.colony.demo.plugins.hello_world.language.portuguese"
    name = "Hello World Portuguese Language Plugin"
    version = "1.0.0"
    platforms = [colony.plugins.plugin_system.CPYTHON_ENVIRONMENT]
    capabilities = ["hello_world.language.portuguese"]
    capabilities_allowed = []
    dependencies = []
        
    def get_language(self):
        return PORTUGUESE_VALUE
        
    def translate(self, sentence):
        return PORTUGUESE_LANGUAGE_HELLO_WORLD
</code>

Easy does it, the Hello World plugin should now be able to say Hello World in Portuguese. Restart Colony and try typing ''say_hello_world portuguese'':

<code txt>
Ola mundo
</code>

Voilá, or should I say, perfeito. The language plugin is pretty much straightforward, the only difference from the first the plugin we created in this tutorial is that this one has a ''hello_world.language.portuguese'' capability, which means that it will be injected into all loaded plugins that allow the ''hello_world'', ''hello_world.language'' or ''hello_world.language.portuguese'' capabilities, and that it has to have the methods expected by each of these capabilities, in this case: get_language() and translate(sentence).

For the next step we will also need a Hello World English Language plugin. Go ahead and create that one on your own, it will be pretty easy. Afterwards, try typing ''showall'' and looking for our plugins:

<code txt>
ID      STATUS      PLUGIN ID
0       ACTIVE      pt.hive.colony.demo.plugins.hello_world
1       ACTIVE      pt.hive.colony.demo.plugins.hello_world.language.portuguese
2       ACTIVE      pt.hive.colony.demo.plugins.hello_world.language.english
...
</code>

The language plugins have automatically loaded because they provide capabilities that are allowed by the Hello World plugin (''hello_world.language''), for this reason, they were loaded and injected in the Hello World plugin as providers of that capability. Try typing ''say_hello_world english'':

<code txt>
Hello world
</code>

It worked as expected, now unload the Hello World English Language plugin by typing ''unload 2'' (or whatever ID the Hello World English Language plugin has), and then type "showall":

<code txt>
ID      STATUS      PLUGIN ID
0       ACTIVE      pt.hive.colony.demo.plugins.hello_world
1       ACTIVE      pt.hive.colony.demo.plugins.hello_world.language.portuguese
2       INACTIVE    pt.hive.colony.demo.plugins.hello_world.language.english
...
</code>

Try typing ''say_hello_world english'' again:

<code txt>
I don't know how to say Hello World in english
</code>

Since the Hello World English Language plugin is unloaded the Hello World plugin doesn't know how to translate the sentence anymore. Type ''say_hello_world portuguese'':

<code txt>
Ola mundo
</code>

Since the Hello World Portuguese Language plugin is still loaded the Hello World plugin can still say Hello World in Portuguese. If you type ''load 2'' and ''say_hello_world english'' the results will be as expected:

<code txt>
Hello world
</code>

There you have it, you have created your very own extensible Colony plugin. The concepts are pretty simple, there are some details here and there that you will learn along the way, but as far as building modular applications with Colony from scratch, they won't detour much from the concepts illustrated in this tutorial. From now on the remaining learning curve will consist mainly of learning how to use the base Colony plugins, so you don't have to write everything from scratch.